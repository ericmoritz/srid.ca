---
date: 2020-09-14T21:11
tags: [nixos]
---

# X1 Carbon Gen 7 + NixOS

I recently purchased a Thinkpad X1 Carbon (Gen 7, with 10th gen processor)[^tw1] and installed [[c7170724]] on it. 

[^tw1]: <https://twitter.com/sridca/status/1304155221183131648>

## Setting up Linux

I used [these instructions](https://github.com/andywhite37/nixos/blob/master/DUAL_BOOT_WINDOWS_GUIDE.md)[^nat] to install NixOS alongside Windows.

[^nat]: Note that you can use the builtin Windows disk manager to resize the partition. No need to install a third party app as this article indicates.

Note the following:

- Disable Secure Boot in BIOS. NixOS won't boot otherwise.
- Use nixos-unstable and choose the latest kernel (`linuxPackages_latest`)

As usual, refer [the Arch wiki](https://wiki.archlinux.org/index.php/Lenovo_ThinkPad_X1_Carbon_(Gen_7)) for details.

See my [configuration.nix](https://github.com/srid/nix-config/blob/master/nixos-configuration/x1c7.nix) for full NixOS config.

## What works

- 4k resolution
  - GNOME selects 200% scaling, which is perfect for the Carbon
- Audio
- Microphone (and Yeti microphone)
- Thunderbolt, with 5k resolution in LG Ultrafine 5k monitor
  - requires 5.9 kernel (`linuxPackages_testing` on NixOS), or [this patch][edd]
- Fingerprint reader
  - Works in both login screen & command-line sudo
- Suspend
- Web camera
- Trackpad
  - Nearly as good as that of a Macbook

[edd]: https://gitlab.freedesktop.org/drm/intel/-/issues/27

## Works, but unreliable

- WiFi periodic interruption, esp. after waking up from suspend
  - Workaround: reboot once.
  - Might need newer firmware/ drivers than what NixOS provides? [See here](https://www.reddit.com/r/thinkpad/comments/iu1de6/x1_carbon_w_5k_monitor_running_linux/g5ijbw9/?utm_source=reddit&utm_medium=web2x&context=3)
- ~~Audio via thunderbolt 3 can be choppy~~ (seems to be fixed in recent updates)
- Netflix video can be choppy on 5k resolution (4k is fine)

## Software issues

- **Google Chrome**: trackpad gestures don't work
- [**Redshift**](https://wiki.archlinux.org/index.php/Redshift) will not work on Wayland; and GNOME's night light is [broken](https://gitlab.gnome.org/GNOME/gnome-settings-daemon/-/issues/39) on 5k tiled display.
  - However, is night mode [all it's cracked up to be][night-light]?
  
[night-light]: https://timesofindia.indiatimes.com/gadgets-news/why-night-mode-may-be-more-dangerous-for-your-eyes/articleshow/72867053.cms